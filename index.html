<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <button onclick="addRc(1)">acc RC</button>
    <script>
    const getGeolocation = ()=>{
        return new Promise ((resolve, reject)=>{

            if ("geolocation" in navigator){
                const success = geolocation=>{
                    resolve(geolocation)
                }
                const error = (geolocation)=>{
                    resolve(null)
                };
                navigator.geolocation.getCurrentPosition(success);
            } else (resolve(null))
        })
    }
    const addRc = (user_id)=>{
        let info = {timestamp: Date.now(), user_id};

        return getGeolocation().then(geolocation=>{
            if (geolocation){
                [longitude, latitude, accuracy] = [geolocation.coords.longitude, geolocation.coords.latitude, geolocation.coords.accuracy]
                info.coords = {latitude, longitude, accuracy};
            }
            return info
        }).then(info => {
            console.log(JSON.stringify(info));
            return fetch('http://127.0.0.1:3306/rc', 
            {
                method: 'POST', 
                body: JSON.stringify(info),
                headers: {
                    "Content-Type": "application/json"
                }
            }
            )
        }).then(x=>console.log("done"))
    }
    </script>
</body>
</html>